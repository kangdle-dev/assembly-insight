<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ì œ22ëŒ€ êµ­íšŒ ë°ì´í„° ì¸ì‚¬ì´íŠ¸</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css');
        :root { --primary: #004EA2; --secondary: #E61E2B; --bg: #f8fafc; }
        body { font-family: 'Pretendard', sans-serif; background: var(--bg); margin: 0; -webkit-tap-highlight-color: transparent; }
        .card { background: white; border-radius: 24px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05); border: 1px solid rgba(0,0,0,0.03); }
        .bar { transition: width 1s ease-in-out; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
    </style>
</head>
<body class="pb-24 md:pb-10 text-slate-900">

<div class="max-w-md mx-auto md:max-w-4xl px-4 pt-6">
    <header class="mb-8">
        <h1 class="text-xl font-black mb-6 text-slate-800 flex items-center gap-2 italic">
            <span class="text-blue-600 text-2xl">ğŸŒ</span> ASSEMBLY <span class="text-slate-400 font-light">INSIGHT</span>
        </h1>
        
        <div class="bg-slate-100 rounded-2xl h-20 mb-6 flex items-center justify-center border border-dashed border-slate-300">
            <span class="text-[10px] font-bold text-slate-400 uppercase tracking-widest italic">AD: Top Billboard (728x90)</span>
        </div>

        <div class="relative">
            <div class="flex items-center bg-white rounded-2xl shadow-lg px-5 py-4 border-2 border-transparent focus-within:border-blue-500 transition-all">
                <i class="fa-solid fa-magnifying-glass text-slate-400 mr-3"></i>
                <input type="text" id="search-input" placeholder="ì˜ì› ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”" class="w-full outline-none text-base font-semibold">
            </div>
            <div id="search-results" class="absolute w-full top-16 left-0 z-[100] bg-white rounded-2xl shadow-2xl border border-slate-100 hidden max-h-[50vh] overflow-y-auto"></div>
        </div>
    </header>

    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-2 gap-4 mb-10">
        <div class="card p-6">
            <h3 class="text-xs font-bold text-slate-400 mb-4 uppercase tracking-widest">ì •ë‹¹ë³„ ì˜ì„ ë¶„í¬</h3>
            <div id="party-charts" class="space-y-4"></div>
        </div>
        <div class="card p-6 text-center flex flex-col justify-center">
            <h3 class="text-xs font-bold text-slate-400 mb-6 uppercase tracking-widest">ë‹¹ì„  í˜•íƒœ</h3>
            <div class="flex justify-around items-center">
                <div><span class="text-3xl font-black text-blue-600" id="stat-local">0</span><p class="text-[10px] text-slate-400 font-bold mt-1 uppercase">ì§€ì—­êµ¬</p></div>
                <div class="w-px h-10 bg-slate-100"></div>
                <div><span class="text-3xl font-black text-purple-500" id="stat-pro">0</span><p class="text-[10px] text-slate-400 font-bold mt-1 uppercase">ë¹„ë¡€ëŒ€í‘œ</p></div>
            </div>
        </div>
    </div>

    <div class="bg-white rounded-3xl p-4 mb-10 border border-slate-200 flex items-center gap-4">
        <div class="w-20 h-20 bg-slate-100 rounded-xl flex-shrink-0 flex items-center justify-center text-[10px] text-slate-400 font-bold italic">AD PIC</div>
        <div class="flex-grow">
            <span class="text-[9px] bg-blue-50 text-blue-600 px-1.5 py-0.5 rounded font-bold uppercase">Sponsor</span>
            <div class="text-sm font-bold text-slate-700 mt-1">ì˜ì • í™œë™ì˜ ìƒˆë¡œìš´ íŒ¨ëŸ¬ë‹¤ì„, êµ­íšŒ ì¸ì‚¬ì´íŠ¸ ê´‘ê³ </div>
            <div class="text-[10px] text-slate-400 mt-0.5">ìì—°ìŠ¤ëŸ½ê²Œ ìŠ¤ë©°ë“œëŠ” ë„¤ì´í‹°ë¸Œ ê´‘ê³ ë¡œ ì „í™˜ìœ¨ ì¦ëŒ€</div>
        </div>
    </div>

    <section class="mb-6">
        <div class="flex items-center justify-between mb-4">
            <h3 class="text-lg font-black text-slate-800">ì˜ì› ëª…ë‹¨</h3>
            <span id="member-count" class="text-[11px] font-bold bg-blue-50 text-blue-600 px-3 py-1 rounded-full tracking-tighter">000ëª…</span>
        </div>
        <div class="flex gap-2 overflow-x-auto no-scrollbar pb-2" id="cho-filter">
            <button class="cho-btn active px-4 py-2 rounded-xl bg-blue-600 text-white text-xs font-bold shadow-md" data-cho="ì „ì²´">ì „ì²´</button>
            </div>
    </section>

    <div id="member-grid" class="grid grid-cols-2 md:grid-cols-2 lg:grid-cols-2 gap-3 md:gap-4"></div>

    <div class="mt-10 text-center">
        <button id="load-more-btn" class="w-full py-4 rounded-2xl bg-white border border-slate-200 text-slate-600 font-bold text-sm shadow-sm hover:bg-slate-50 transition-all flex items-center justify-center gap-2">
            ì˜ì› ë”ë³´ê¸° <i class="fa-solid fa-chevron-down opacity-50"></i>
        </button>
    </div>
</div>

<nav class="fixed bottom-0 left-0 right-0 bg-white/90 backdrop-blur-md border-t border-slate-100 flex justify-around py-3 z-50 md:hidden">
    <button class="flex flex-col items-center gap-1 text-blue-600"><i class="fa-solid fa-home text-lg"></i><span class="text-[9px] font-bold">í™ˆ</span></button>
    <button class="flex flex-col items-center gap-1 text-slate-400" onclick="location.href='detail.html'"><i class="fa-solid fa-file-invoice text-lg"></i><span class="text-[9px]">ë¦¬í¬íŠ¸</span></button>
</nav>

<script>
    let allMembers = [];
    let filteredMembers = [];
    let displayCount = 12; // í•œ ë²ˆì— ë³´ì—¬ì¤„ ì˜ì› ìˆ˜
    const CHOSUNG = ['ã„±', 'ã„²', 'ã„´', 'ã„·', 'ã„¸', 'ã„¹', 'ã…', 'ã…‚', 'ã…ƒ', 'ã……', 'ã…†', 'ã…‡', 'ã…ˆ', 'ã…‰', 'ã…Š', 'ã…‹', 'ã…Œ', 'ã…', 'ã…'];

    async function init() {
        try {
            const response = await fetch('data_export/members_all.json');
            if (!response.ok) throw new Error("JSON ë¡œë“œ ì‹¤íŒ¨");
            const rawData = await response.json();
            
            allMembers = rawData.filter(m => m.is_22nd === true || String(m.is_22nd) === "true");
            filteredMembers = allMembers;

            renderChoFilter();
            updateDashboard(allMembers);
            renderGrid();
        } catch (error) {
            console.error("Error:", error);
            document.getElementById('member-grid').innerHTML = "<p class='col-span-full text-center py-20 text-slate-400'>ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>";
        }
    }

    // ì´ˆì„± ë²„íŠ¼ ìƒì„± ë¡œì§
    function renderChoFilter() {
        const filterContainer = document.getElementById('cho-filter');
        CHOSUNG.forEach(cho => {
            const btn = document.createElement('button');
            btn.className = "cho-btn px-4 py-2 rounded-xl bg-white text-slate-400 text-xs font-bold shadow-sm border border-slate-50";
            btn.innerText = cho;
            btn.onclick = () => filterByCho(cho, btn);
            filterContainer.appendChild(btn);
        });
    }

    // ì´ˆì„± í•„í„°ë§ í•¨ìˆ˜
    function filterByCho(cho, btn) {
        // UI ë²„íŠ¼ ìƒíƒœ ë³€ê²½
        document.querySelectorAll('.cho-btn').forEach(b => {
            b.classList.replace('bg-blue-600', 'bg-white');
            b.classList.replace('text-white', 'text-slate-400');
        });
        btn.classList.replace('bg-white', 'bg-blue-600');
        btn.classList.replace('text-slate-400', 'text-white');

        if (cho === "ì „ì²´") {
            filteredMembers = allMembers;
        } else {
            filteredMembers = allMembers.filter(m => {
                const name = m.NAAS_NM || m.HG_NM || "";
                const code = name.charCodeAt(0) - 44032;
                if (code > -1 && code < 11172) return CHOSUNG[Math.floor(code / 588)] === cho;
                return false;
            });
        }
        displayCount = 12; // í•„í„°ë§ ì‹œ ì´ˆê¸°í™”
        renderGrid();
    }

    function updateDashboard(data) {
        document.getElementById('member-count').innerText = `${data.length}ëª…`;
        const parties = {};
        let local = 0, pro = 0;
        data.forEach(m => {
            const p = m.CURR_PLPT_NM || "ë¬´ì†Œì†";
            parties[p] = (parties[p] || 0) + 1;
            const dist = m.CURR_ELECD_NM || "";
            if (dist.includes('ë¹„ë¡€')) pro++; else local++;
        });

        const sortedParties = Object.entries(parties).sort((a,b) => b[1] - a[1]);
        document.getElementById('party-charts').innerHTML = sortedParties.slice(0, 4).map(([name, count]) => `
            <div>
                <div class="flex justify-between text-[10px] font-bold mb-1"><span class="text-slate-500">${name}</span><span>${count}</span></div>
                <div class="w-full bg-slate-100 h-1 rounded-full overflow-hidden">
                    <div class="bar h-full rounded-full" style="width: ${(count/data.length*100)}%; background: ${getPartyColor(name)}"></div>
                </div>
            </div>
        `).join('');
        document.getElementById('stat-local').innerText = local;
        document.getElementById('stat-pro').innerText = pro;
    }

    function renderGrid() {
        const grid = document.getElementById('member-grid');
        const itemsToDisplay = filteredMembers.slice(0, displayCount);
        
        grid.innerHTML = itemsToDisplay.map((m, idx) => `
            <div class="card p-4 flex items-center gap-4 cursor-pointer active:scale-95 transition-all" onclick="location.href='detail.html?id=${m.NAAS_CD || m.MONA_CD}'">
                <div class="w-16 h-16 rounded-2xl overflow-hidden bg-slate-100 flex-shrink-0">
                    <img src="./${m.PHOTO_PATH}" class="w-full h-full object-cover" onerror="this.src='https://via.placeholder.com/100'">
                </div>
                <div>
                    <div class="text-[10px] font-black" style="color: ${getPartyColor(m.CURR_PLPT_NM)}">${m.CURR_PLPT_NM}</div>
                    <div class="font-bold text-slate-800">${m.NAAS_NM || m.HG_NM}</div>
                    <div class="text-[9px] text-slate-400 font-bold">${m.CURR_ELECD_NM}</div>
                </div>
            </div>
        `).join('');

        // ë”ë³´ê¸° ë²„íŠ¼ ë…¸ì¶œ ì—¬ë¶€
        document.getElementById('load-more-btn').style.display = (displayCount >= filteredMembers.length) ? 'none' : 'flex';
    }

    // ë”ë³´ê¸° ë²„íŠ¼ ì´ë²¤íŠ¸
    document.getElementById('load-more-btn').onclick = () => {
        displayCount += 12;
        renderGrid();
    };

    function getPartyColor(party) {
        if (!party) return '#cbd5e1';
        if (party.includes('ë”ë¶ˆì–´ë¯¼ì£¼ë‹¹')) return '#004EA2';
        if (party.includes('êµ­ë¯¼ì˜í˜')) return '#E61E2B';
        if (party.includes('ì¡°êµ­í˜ì‹ ë‹¹')) return '#00A0E2';
        if (party.includes('ê°œí˜ì‹ ë‹¹')) return '#FF6600';
        return '#64748b';
    }

    init();
</script>
</body>
</html>