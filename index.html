<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ì œ22ëŒ€ êµ­íšŒ ë°ì´í„° ì¸ì‚¬ì´íŠ¸</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css');
        :root { --primary: #004EA2; --secondary: #E61E2B; --bg: #f8fafc; }
        body { font-family: 'Pretendard', sans-serif; background: var(--bg); margin: 0; -webkit-tap-highlight-color: transparent; }
        .card { background: white; border-radius: 24px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05); border: 1px solid rgba(0,0,0,0.03); }
        .bar { transition: width 1s cubic-bezier(0.4, 0, 0.2, 1); }
        #search-results::-webkit-scrollbar { width: 4px; }
        #search-results::-webkit-scrollbar-thumb { background: #e2e8f0; border-radius: 10px; }
    </style>
</head>
<body class="pb-24">

<div class="max-w-md mx-auto md:max-w-6xl px-4 pt-6">
    <header class="mb-8">
        <h1 class="text-xl font-black mb-6 text-slate-800 flex items-center gap-2">
            <span class="text-blue-600 text-2xl">ğŸŒ</span> ì œ22ëŒ€ êµ­íšŒ ì¸ì‚¬ì´íŠ¸
        </h1>
        <div class="relative">
            <div class="flex items-center bg-white rounded-2xl shadow-lg px-5 py-4 border-2 border-transparent focus-within:border-blue-500 transition-all">
                <i class="fa-solid fa-magnifying-glass text-slate-400 mr-3"></i>
                <input type="text" id="search-input" placeholder="ì˜ì› ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”" class="w-full outline-none text-base font-semibold">
            </div>
            <div id="search-results" class="absolute w-full top-16 left-0 z-[100] bg-white rounded-2xl shadow-2xl border border-slate-100 hidden max-h-[60vh] overflow-y-auto"></div>
        </div>
    </header>

    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-2 gap-4 mb-10">
        <div class="card p-6">
            <h3 class="text-xs font-bold text-slate-400 mb-4 uppercase tracking-wider">ì •ë‹¹ë³„ ì˜ì„ ë¶„í¬</h3>
            <div id="party-charts" class="space-y-4"></div>
        </div>

        <div class="card p-6 text-center">
            <h3 class="text-xs font-bold text-slate-400 mb-6 uppercase tracking-wider">ë‹¹ì„  í˜•íƒœ</h3>
            <div class="flex justify-around items-center">
                <div>
                    <span class="text-3xl font-black text-blue-600 block" id="stat-local">0</span>
                    <p class="text-[10px] text-slate-400 font-bold mt-1">ì§€ì—­êµ¬</p>
                </div>
                <div class="w-px h-10 bg-slate-100"></div>
                <div>
                    <span class="text-3xl font-black text-purple-500 block" id="stat-pro">0</span>
                    <p class="text-[10px] text-slate-400 font-bold mt-1">ë¹„ë¡€ëŒ€í‘œ</p>
                </div>
            </div>
        </div>

        <div class="card p-6 text-center">
            <h3 class="text-xs font-bold text-slate-400 mb-4 uppercase tracking-wider">ì—°ë ¹ëŒ€ë³„ ë¶„í¬</h3>
            <div class="flex justify-between items-end gap-1 px-2" id="age-dist"></div>
            <p class="mt-4 text-[10px] text-slate-400">í‰ê·  ì—°ë ¹ <span id="avg-age" class="font-bold text-slate-700">-</span>ì„¸</p>
        </div>

        <div class="card p-6">
            <h3 class="text-xs font-bold text-slate-400 mb-4 uppercase tracking-wider">ì •ë‹¹ë³„ í‰ê·  ì—°ë ¹</h3>
            <div id="party-age-list" class="space-y-3"></div>
        </div>

        <div class="grid grid-cols-2 gap-3 md:col-span-2 lg:col-span-2" id="edge-members"></div>
    </div>

    <div class="flex justify-between items-center mb-6 px-1">
        <h3 class="text-lg font-black text-slate-800">ì˜ì› ëª…ë‹¨</h3>
        <span id="member-count" class="text-[11px] font-bold bg-blue-50 text-blue-600 px-3 py-1 rounded-full">ë°ì´í„° ë¡œë”©...</span>
    </div>
    <div id="member-grid" class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-3 md:gap-4"></div>
</div>

<nav class="fixed bottom-0 left-0 right-0 bg-white/90 backdrop-blur-md border-t border-slate-100 flex justify-around py-3 z-50 md:hidden">
    <button class="flex flex-col items-center gap-1 text-blue-600"><i class="fa-solid fa-home text-lg"></i><span class="text-[9px] font-bold">í™ˆ</span></button>
    <button class="flex flex-col items-center gap-1 text-slate-400"><i class="fa-solid fa-bolt text-lg"></i><span class="text-[9px]">ì •ì±…ëŒ€ë¦½</span></button>
    <button class="flex flex-col items-center gap-1 text-slate-400"><i class="fa-solid fa-user-shield text-lg"></i><span class="text-[9px]">ë²”ì£„ì´ë ¥</span></button>
</nav>

<script>
    let allMembers = [];
    const currentYear = 2026;
    const memberGrid = document.getElementById('member-grid');

    async function init() {
        try {
            const response = await fetch('data_export/members_all.json');            
            if (!response.ok) throw new Error("File not found");
            const rawData = await response.json();
            
            // ë°ì´í„° í•„í„°ë§ ë¡œì§ ê°•í™”
            allMembers = rawData.filter(m => m.is_22nd === true || String(m.is_22nd) === "true");
            if (allMembers.length === 0) allMembers = rawData; 

            updateDashboard(allMembers);
            renderGrid(allMembers);
        } catch (error) {
            console.error(error);
            document.getElementById('member-grid').innerHTML = "<p class='col-span-full text-center py-20 text-slate-400 text-sm'>ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>";
        }
    }

    function updateDashboard(data) {
        document.getElementById('member-count').innerText = `ì´ ${data.length}ëª…`;

        const parties = {};
        const partyAges = {};
        const ageGroups = { '30ëŒ€â†“': 0, '40ëŒ€': 0, '50ëŒ€': 0, '60ëŒ€â†‘': 0 };
        let localCount = 0; let proCount = 0; let totalAge = 0; let validAgeCount = 0;

        data.forEach(m => {
            // 1. ì •ë‹¹ í†µê³„
            const pName = m.CURR_PLPT_NM || m.PLPT_NM || "ë¬´ì†Œì†";
            parties[pName] = (parties[pName] || 0) + 1;

            // 2. ë‹¹ì„  í˜•íƒœ
            const dist = m.CURR_ELECD_NM || m.ELECD_NM || "";
            if (dist.includes('ë¹„ë¡€ëŒ€í‘œ')) proCount++; else localCount++;

            // 3. ë‚˜ì´ ê³„ì‚° (ì˜¤ë¥˜ ë°©ì§€ ë¡œì§)
            const bDay = m.BIRDY_DT || m.BIRDY_DT_NM || "";
            if (bDay && bDay.length >= 4) {
                const birthYear = parseInt(bDay.substring(0, 4));
                if (!isNaN(birthYear)) {
                    const age = currentYear - birthYear;
                    totalAge += age;
                    validAgeCount++;

                    if (age < 40) ageGroups['30ëŒ€â†“']++;
                    else if (age < 50) ageGroups['40ëŒ€']++;
                    else if (age < 60) ageGroups['50ëŒ€']++;
                    else ageGroups['60ëŒ€â†‘']++;

                    if (!partyAges[pName]) partyAges[pName] = { sum: 0, count: 0 };
                    partyAges[pName].sum += age;
                    partyAges[pName].count++;
                }
            }
        });

        // UI ë Œë”ë§ - ì •ë‹¹ ì°¨íŠ¸
        const sortedParties = Object.entries(parties).sort((a,b) => b[1] - a[1]);
        document.getElementById('party-charts').innerHTML = sortedParties.slice(0, 4).map(([name, count]) => `
            <div>
                <div class="flex justify-between text-[11px] font-bold mb-1.5">
                    <span class="text-slate-600">${name}</span>
                    <span class="text-slate-900">${count}</span>
                </div>
                <div class="w-full bg-slate-100 h-1.5 rounded-full overflow-hidden">
                    <div class="bar h-full rounded-full" style="width: ${(count/data.length*100)}%; background: ${getPartyColor(name)}"></div>
                </div>
            </div>
        `).join('');

        // UI ë Œë”ë§ - ì—°ë ¹ëŒ€ ë¶„í¬
        document.getElementById('age-dist').innerHTML = Object.entries(ageGroups).map(([label, count]) => `
            <div class="flex-1">
                <span class="text-lg font-black text-slate-800 block">${count}</span>
                <span class="text-[9px] text-slate-400 font-bold uppercase">${label}</span>
            </div>
        `).join('');

        document.getElementById('stat-local').innerText = localCount;
        document.getElementById('stat-pro').innerText = proCount;
        document.getElementById('avg-age').innerText = validAgeCount > 0 ? (totalAge / validAgeCount).toFixed(1) : "-";

        // ì •ë‹¹ë³„ í‰ê·  ì—°ë ¹
        document.getElementById('party-age-list').innerHTML = sortedParties.slice(0, 3).map(([name, count]) => {
            const stats = partyAges[name];
            const avg = stats ? (stats.sum / stats.count).toFixed(1) : 0;
            return `
                <div class="flex justify-between items-center text-[11px]">
                    <span class="font-bold text-slate-500">${name}</span>
                    <span class="font-black text-blue-600">${avg}ì„¸</span>
                </div>
                <div class="w-full bg-slate-50 h-1 rounded-full mt-1 mb-2">
                    <div class="h-full rounded-full opacity-50" style="width: ${avg*1.2}%; background: ${getPartyColor(name)}"></div>
                </div>
            `;
        }).join('');

        // ìµœê³ ë ¹/ìµœì—°ì†Œ
        const validMembers = data.filter(m => (m.BIRDY_DT || m.BIRDY_DT_NM)).sort((a,b) => 
            new Date(a.BIRDY_DT || a.BIRDY_DT_NM) - new Date(b.BIRDY_DT || b.BIRDY_DT_NM));
        
        if (validMembers.length >= 2) {
            document.getElementById('edge-members').innerHTML = `
                ${renderSmallProfile(validMembers[0], 'ìµœê³ ë ¹')}
                ${renderSmallProfile(validMembers[validMembers.length-1], 'ìµœì—°ì†Œ')}
            `;
        }
    }

    function renderSmallProfile(m, label) {
        const age = currentYear - parseInt((m.BIRDY_DT || m.BIRDY_DT_NM).substring(0,4));
        return `
            <div class="card p-4 flex items-center gap-3">
                <img src="./${m.PHOTO_PATH}" class="w-12 h-12 rounded-xl object-cover bg-slate-50" onerror="this.src='https://via.placeholder.com/100'">
                <div>
                    <span class="text-[9px] font-black text-blue-500 bg-blue-50 px-1.5 py-0.5 rounded uppercase">${label}</span>
                    <div class="text-sm font-bold text-slate-800">${m.NAAS_NM || m.HG_NM}</div>
                    <div class="text-[10px] text-slate-400 font-medium">${age}ì„¸ Â· ${m.CURR_PLPT_NM || m.PLPT_NM}</div>
                </div>
            </div>
        `;
    }

    function renderGrid(members) {
        memberGrid.innerHTML = members.map(m => `
            <div class="card p-3 flex flex-col items-center border-t-4" 
                 style="border-top-color: ${getPartyColor(m.CURR_PLPT_NM || m.PLPT_NM)}"
                 onclick="location.href='detail.html?id=${m.NAAS_CD || m.MONA_CD}'">
                <div class="w-full aspect-[3/4] rounded-xl overflow-hidden mb-3 bg-slate-50">
                    <img src="./${m.PHOTO_PATH}" class="w-full h-full object-cover" loading="lazy" onerror="this.src='https://via.placeholder.com/300x400?text=ğŸ‘¤'">
                </div>
                <h4 class="font-bold text-sm mb-0.5 text-slate-800">${m.NAAS_NM || m.HG_NM}</h4>
                <p class="text-[10px] font-bold text-slate-400 mb-2">${m.CURR_PLPT_NM || m.PLPT_NM}</p>
                <div class="flex gap-1">
                    <span class="text-[9px] bg-slate-100 text-slate-500 px-1.5 py-0.5 rounded font-bold">${m.RLCT_COUNT || m.RLCT_DIV_NM || 'ì´ˆì„ '}</span>
                    <span class="text-[9px] bg-slate-100 text-slate-500 px-1.5 py-0.5 rounded font-bold">${(m.CURR_ELECD_NM || "ë¹„ë¡€").split(' ')[0]}</span>
                </div>
            </div>
        `).join('');
    }

    // ì‹¤ì‹œê°„ ê²€ìƒ‰
    document.getElementById('search-input').addEventListener('input', (e) => {
        const val = e.target.value.trim();
        const results = document.getElementById('search-results');
        if (!val) { results.classList.add('hidden'); return; }
        
        const filtered = allMembers.filter(m => (m.NAAS_NM || m.HG_NM || "").includes(val)).slice(0, 8);
        if (filtered.length > 0) {
            results.classList.remove('hidden');
            results.innerHTML = filtered.map(m => `
                <div class="flex items-center p-4 border-b border-slate-50 active:bg-slate-50 cursor-pointer" onclick="location.href='detail.html?id=${m.NAAS_CD || m.MONA_CD}'">
                    <img src="./${m.PHOTO_PATH}" class="w-10 h-10 rounded-full object-cover mr-3 bg-slate-100" onerror="this.src='https://via.placeholder.com/50'">
                    <div>
                        <div class="text-sm font-bold text-slate-800">${m.NAAS_NM || m.HG_NM} <span class="text-[10px] font-normal text-slate-400 ml-1">${m.CURR_PLPT_NM || m.PLPT_NM}</span></div>
                        <div class="text-[10px] text-slate-400">${m.CURR_ELECD_NM || m.ELECD_NM}</div>
                    </div>
                </div>
            `).join('');
        } else {
            results.classList.add('hidden');
        }
    });

    function getPartyColor(party) {
        if (!party) return '#cbd5e1';
        if (party.includes('ë”ë¶ˆì–´ë¯¼ì£¼ë‹¹')) return '#004EA2';
        if (party.includes('êµ­ë¯¼ì˜í˜')) return '#E61E2B';
        if (party.includes('ì¡°êµ­í˜ì‹ ë‹¹')) return '#00A0E2';
        if (party.includes('ê°œí˜ì‹ ë‹¹')) return '#FF6600';
        if (party.includes('ì§„ë³´ë‹¹')) return '#d6001c';
        return '#64748b';
    }

    init();
</script>

</body>
</html>